\documentclass{standalone}

% The idea here, for now,
% is to construct a framework flexible enough
% to easily draw the various states of the files/tree/history,
% so it becomes easier to animate afterwards.
% This file will be typically (re-)generated from some other script.

\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{mathptmx}
\usepackage[T1]{fontenc}

\usepackage{xkeyval}
\usepackage{etoolbox}
\usepackage{tikz}%
  \usetikzlibrary{math}
  \usetikzlibrary{positioning}
  \usetikzlibrary{calc}
  \usetikzlibrary{arrows.meta}
\tikzset{
  x=1mm,
  y=1mm,
  inner sep=0,
  file tree line/.style={line width=1.5, line cap=round},
  % https://tex.stackexchange.com/a/447931/72679
  local to/.style={
      shift={(#1.center)},
      x={(#1.east)},
      y={(#1.north)},
  }
}

\input{palette}

\tikzmath{
  \ScreenWidth = 400;
  \ScreenHeight = 300;
  \TitleBarHeight = 35;
  \TitleScale = 5.0;
  \SubTitleScale = 3.5;
  \PageNumScale = 2.0;
  \ProgressHeight = 1.5;
  \Progress = 1/3;
  \CanvasMargin = 5;
  \eps = 0.1; % Useful to avoid seemingly pixel-rounding errors.
}

\newcommand{\TitleText}{Title}
\newcommand{\SubTitleText}{Subtitle}
\newcommand{\PageNumText}{99}

\input{files}
\input{diff}
\input{commits}

\begin{document}


\begin{tikzpicture}

  \pgfdeclarelayer{background}
  \pgfsetlayers{background, main}

  % Set off global structure first.

  % Whole screen, setting the page size.
  \node[anchor=south west] (Screen) {\tikz{
    \path (0, 0) rectangle (\ScreenWidth, \ScreenHeight)}};

  % Title bar.
  \node[anchor=north] (TitleBar) at (Screen.north) {\tikz{
    \fill[Dark3] (0, 0) rectangle (\ScreenWidth, \TitleBarHeight);}};

  % Title.
  \node[Light2, anchor=base west, scale=\TitleScale,
        right=10 of TitleBar.west] (Title) {\bf \TitleText};

  % SubTitle.
  \node[Light2, anchor=base east, scale=\SubTitleScale,
        left=10 of TitleBar.east] (SubTitle) {\bf \SubTitleText};

  % Page number.
  \node[Dark4, inner sep=5, anchor=south east, scale=\PageNumScale]
    (PageNum) at (Screen.south east) {\bf \PageNumText};

  % Progress bar,
  % fix vertical borders white pixel lines with epsilon shifts.
  \coordinate (upper) at
    ($(TitleBar.south east) + (-\eps, \ProgressHeight)$);
  \coordinate[right=\eps of TitleBar.south west] (lower);
  \fill[Yellow1] (lower) rectangle (upper);
  \coordinate[left=(1-\Progress)*\ScreenWidth of upper] (upper);
  \fill[Orange1] (lower) rectangle (upper);

  % The "Canvas" refers to only the white area reserved for actual drawing,
  % minus a short margin.
  \coordinate (offset) at (\CanvasMargin, \CanvasMargin);
  \node[anchor=south west] at (offset) (Canvas) {\tikz{
    \path (offset) rectangle ($(TitleBar.south east) - (offset)$);}};

  \node[anchor=north west] (A) at (Canvas.north west) {\Folder};
  \Name[folder]{A}{folder\_name}
  \AppendSibling[file][B]{A}{filename.ext}
  \AppendSibling[folder][C]{B}{container}

  \FirstChild[file][D]{C}{contained.ext}
  \AppendSibling[file, connect][E]{D}{other.ext}
  \AppendSibling[folder, connect][F]{E}{subcontainer}

  \FirstChild[file]{F}{inner.ext}

  \coordinate (top) at ($(Canvas.center)!.5!(Canvas.north)$);

  \FileContent[+]{$(Canvas.center)!.5!(Canvas.north)$}{Filename.ext}{
    +/{First line in the file, added style.},
    0/{Second line, neutral style},
    -/{Third line, removed style}
  }

  \coordinate (tp) at ($(Canvas.south)!.5!(Canvas.south west)$);
  \Commits{$(tp) + (0, 15)$}{%
    hash256/{Commit message.},
    dbc41a4/{Second commit.},
    9f1d6da/{Third commit with a longer message.},
    0c4381c/{Latest commit, with the branch and HEAD.}
  }

  \Branch{0c4381c}{40:20}{-.5,0}{main}
  \Head{9f1d6da}{155:20}{.5,0}

\end{tikzpicture}


\end{document}

